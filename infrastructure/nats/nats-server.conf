# =============================================================================
# NATS Server Configuration for Flight Training Management System
# =============================================================================

# Server Identification
server_name: ftms-nats

# Client Connections
port: 4222
max_connections: 1000
max_payload: 1MB

# HTTP Monitoring
http_port: 8222

# Cluster Configuration (for future scaling)
cluster {
    name: ftms-cluster
    port: 6222
    # Uncomment for multi-node cluster:
    # routes: [
    #     nats-route://nats-1:6222
    #     nats-route://nats-2:6222
    #     nats-route://nats-3:6222
    # ]
}

# JetStream Configuration (Persistent Messaging)
jetstream {
    store_dir: /data/jetstream
    max_memory_store: 256MB
    max_file_store: 1GB
}

# Logging
debug: false
trace: false
logtime: true
log_file: "/data/nats-server.log"

# Authentication
# For development, use simple user/password
# For production, use NKeys or JWT-based auth
authorization {
    users: [
        {
            user: admin
            password: $NATS_PASSWORD
            permissions: {
                publish: ">"
                subscribe: ">"
            }
        },
        # Service-specific users (optional, for fine-grained access)
        {
            user: user-service
            password: $USER_SERVICE_NATS_PASSWORD
            permissions: {
                publish: ["ftms.user.>", "_INBOX.>"]
                subscribe: ["ftms.>", "_INBOX.>"]
            }
        },
        {
            user: notification-service
            password: $NOTIF_SERVICE_NATS_PASSWORD
            permissions: {
                publish: ["ftms.notification.>", "_INBOX.>"]
                subscribe: ["ftms.>", "_INBOX.>"]
            }
        }
    ]
}

# Connection Limits
max_pending: 10MB
write_deadline: "2s"

# Ping/Pong Settings
ping_interval: "30s"
ping_max: 3

# TLS Configuration (for production)
# tls {
#     cert_file: "/etc/nats/certs/server-cert.pem"
#     key_file: "/etc/nats/certs/server-key.pem"
#     ca_file: "/etc/nats/certs/ca.pem"
#     verify: true
# }
